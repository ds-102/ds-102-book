
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Causal Inference in Randomized Experiments &#8212; Data, Inference, and Decisions</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/chapters/04/04_randomized_experiments';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Causal Inference in Observational Studies: Unconfoundedness" href="05_observational_studies_unconfoundedness.html" />
    <link rel="prev" title="Causality" href="03_causality.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Data, Inference, and Decisions</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data, Inference, and Decisions
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/intro.html">Chapter 1: Binary Decision-Making</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/01_decisions_and_errors.html">Binary Decision-Making and Error Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/02_hypothesis_testing.html">Hypothesis Testing and p-Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/03_multiple_tests.html">Multiple Hypothesis Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/04_binary_classification.html">Binary Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/05_decision_theory.html">Decision Theory</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/intro.html">Chapter 2: Bayesian modeling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/01_parameter_estimation.html">Parameter Estimation and Bayesian Inference Fundamentals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/02_hierarchical_models.html">Hierarchical Bayesian Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/03_graphical_models.html">Graphical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/04_inference.html">Bayesian Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/05_inference_with_sampling.html">Bayesian Inference with Sampling</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03/intro.html">Chapter 3: Prediction</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../03/01_prediction.html">Prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/02_regression_review.html">Linear Regression Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/03_glms.html">Generalized Linear Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/04_model_checking.html">[WIP] Model Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/05_uncertainty_quantification.html">[WIP] Uncertainty Quantification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/06_nonparametric.html">Nonparametric Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03/07_neural_networks.html">Neural Networks</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Chapter 4: Causal Inference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_association_correlation_causation.html">Understanding Association</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_quantifying_association.html">Quantifying Association</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_causality.html">Causality and Potential Outcomes</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Causality in Randomized Experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_observational_studies_unconfoundedness.html">Causality in Observational Studies: Unconfoundedness</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ds-102/ds-102-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ds-102/ds-102-book/issues/new?title=Issue%20on%20page%20%2Fcontent/chapters/04/04_randomized_experiments.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/content/chapters/04/04_randomized_experiments.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Causal Inference in Randomized Experiments</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#randomized-experiments-and-potential-outcomes">Randomized experiments and potential outcomes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-average-treatment-effect">Computing the average treatment effect</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-fixed-sample-assumption-fisher-and-neyman">(Optional) Fixed-sample assumption: Fisher and Neyman</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-neyman-estimator">Properties of the Neyman estimator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-for-the-ate">Confidence intervals for the ATE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hypothesis-testing-for-causal-effects">Hypothesis testing for causal effects</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-complications-with-randomized-experiments">(Optional) Complications with randomized experiments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compliance">Compliance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#external-validity">External validity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ethical-considerations">Ethical considerations</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="causal-inference-in-randomized-experiments">
<h1>Causal Inference in Randomized Experiments<a class="headerlink" href="#causal-inference-in-randomized-experiments" title="Link to this heading">#</a></h1>
<p>In this section, we’ll build a deeper understanding of randomized experiments. Recall from the last section the table of potential outcomes:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Unit</p></th>
<th class="head"><p>Outcome if not treated</p></th>
<th class="head"><p>Outcome if treated</p></th>
<th class="head"><p>Treated or not?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>?</p></td>
<td><p><span class="math notranslate nohighlight">\(Y_1(1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(Z_1=1\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><span class="math notranslate nohighlight">\(Y_2(0)\)</span></p></td>
<td><p>?</p></td>
<td><p><span class="math notranslate nohighlight">\(Z_2=0\)</span></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><span class="math notranslate nohighlight">\(Y_3(0)\)</span></p></td>
<td><p>?</p></td>
<td><p><span class="math notranslate nohighlight">\(Z_3=0\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>?</p></td>
<td><p><span class="math notranslate nohighlight">\(Y_4(1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(Z_4=1\)</span></p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p><span class="math notranslate nohighlight">\(Y_5(0)\)</span></p></td>
<td><p>?</p></td>
<td><p><span class="math notranslate nohighlight">\(Z_5=0\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<section id="randomized-experiments-and-potential-outcomes">
<h2>Randomized experiments and potential outcomes<a class="headerlink" href="#randomized-experiments-and-potential-outcomes" title="Link to this heading">#</a></h2>
<p>In a randomized experiment, we protect ourselves from dealing with confounding variables by randomizing units into treatment and control. In other words, we choose each <span class="math notranslate nohighlight">\(Z_i\)</span> randomly, and we choose it independent of whatever <span class="math notranslate nohighlight">\(Y_i(0)\)</span> and <span class="math notranslate nohighlight">\(Y_i(1)\)</span> might be. Mathematically, we can write:</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
    \big(Y_i(0), Y_i(1)\big) \perp \!\!\! \perp Z_i
\end{align}
\]</div>
<p>Remember, this doesn’t mean that the treatment is independent from the observed outcome! It only means that the treatment is independent from the <em>pair</em> of potential outcomes. The observed outcome <span class="math notranslate nohighlight">\(Y_{i,obs} = Y_i(0)(1-Z_i) + Y_i(1) Z_i\)</span> always depends on the treatment decision. In other words, knowing the treatment decision <span class="math notranslate nohighlight">\(Z_i\)</span> always gives us information about <em>which</em> of the two potential outcomes (<span class="math notranslate nohighlight">\(Y_i(0)\)</span> or <span class="math notranslate nohighlight">\(Y_i(1)\)</span>) we observed (except in the uninteresting scenario where the treatment is completely unrelated to the outcome), but</p>
<p>For example, consider a double-blind vaccine trial. We can consider the potential outcomes for a particular subject: they represent what happens to that subject if they get the vaccine (<span class="math notranslate nohighlight">\(Y_i(1)\)</span>) or if they don’t get the vaccine (<span class="math notranslate nohighlight">\(Y_i(0)\)</span>). This is the pair of potential outcomes, <span class="math notranslate nohighlight">\(\big(Y_i(0), Y_i(1)\big)\)</span>. Next, consider the treatment decision <span class="math notranslate nohighlight">\(Z_i\)</span>: this represents whether the subject got the vaccine (<span class="math notranslate nohighlight">\(Z_i = 1\)</span>) or a placebo (<span class="math notranslate nohighlight">\(Z_i = 0\)</span>). These are independent: knowing whether or not a subject got the vaccine/placebo gives us no information about the pair of potential outcomes: it only gives us information about which one of the two we observe in the real world.</p>
<section id="computing-the-average-treatment-effect">
<h3>Computing the average treatment effect<a class="headerlink" href="#computing-the-average-treatment-effect" title="Link to this heading">#</a></h3>
<p>You may remember learning that in a randomized controlled trial, we can determine causality by using the difference in means between the treatment and control groups. Let’s now show mathematically that this is true. Recall from the previous section our definition of the ATE <span class="math notranslate nohighlight">\(\tau\)</span>:</p>
<div class="math notranslate nohighlight">
\[\tau = E[Y_i(1) - Y_i(0)] = E[Y_i(1)] - E[Y_i(0)]\]</div>
<p>If <span class="math notranslate nohighlight">\(Z_i\)</span> and <span class="math notranslate nohighlight">\(Y_i\)</span> are independent, then <span class="math notranslate nohighlight">\(E[Y_i(\cdot)] = E[Y_i(\cdot)|Z_i]\)</span>. In other words, conditioning on <span class="math notranslate nohighlight">\(Z_i\)</span> shouldn’t change the expectation, as long as <span class="math notranslate nohighlight">\(Z_i\)</span> and <span class="math notranslate nohighlight">\(Y_i(\cdot)\)</span> are independent.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
    \tau
        &amp;= E[Y_i(1)] - E[Y_i(0)] \\
        &amp;= E[Y_i(1)|Z_i=1] - E[Y_i(0)|Z_i=0] \quad{\scriptsize (\text{if }(Y_i(0), Y_i(1)) \perp \!\! \perp Z_i)}
\end{align}
\end{split}\]</div>
<p>These two terms correspond to the mean outcomes in the treatment and control groups, respectively. If we have <span class="math notranslate nohighlight">\(n\)</span> observations <span class="math notranslate nohighlight">\((Z_1, Y_{1,obs}), \ldots, (Z_n, Y_{n,obs})\)</span>, then our empirical estimate for the ATE is just:</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
    \hat{\tau}
        &amp;= \underbrace{\left[\frac{1}{n_1} \sum_{i: Z_i = 1} Y_i\right]}_{=\bar{Y}_{obs,1}} - \underbrace{\left[\frac{1}{n_0} \sum_{i: Z_i = 0} Y_i\right]}_{=\bar{Y}_{obs,0}},
\end{align}
\]</div>
<p>where <span class="math notranslate nohighlight">\(n_1\)</span> is the number of treated units and <span class="math notranslate nohighlight">\(n_0\)</span> is the number of untreated units, and <span class="math notranslate nohighlight">\(\bar{Y}_{obs,1}\)</span> and <span class="math notranslate nohighlight">\(\bar{Y}_{obs,0}\)</span> are the means of the treatment and control groups respectively. This quantity <span class="math notranslate nohighlight">\(\hat{\tau}\)</span>, which you’ve most likely seen and used before (e.g., in Data 8), has many names. Here are a few of them:</p>
<ul class="simple">
<li><p>The <strong>difference in means</strong></p></li>
<li><p>The <strong>simple difference in mean outcomes / simple difference in observed means (SDO)</strong></p></li>
<li><p>The <strong>Neyman estimator</strong></p></li>
<li><p>The <strong><em>prima facie</em> causal effect</strong>, <span class="math notranslate nohighlight">\(\tau_{PF}\)</span> (<em>prima facie</em> is latin for “at first sight”).</p></li>
</ul>
</section>
</section>
<section id="optional-fixed-sample-assumption-fisher-and-neyman">
<h2>(Optional) Fixed-sample assumption: Fisher and Neyman<a class="headerlink" href="#optional-fixed-sample-assumption-fisher-and-neyman" title="Link to this heading">#</a></h2>
<p>In this section, we’ll analyze randomized experiments and the Neyman estimator under the fixed-sample assumption. Recall that in this setting, we assume that <span class="math notranslate nohighlight">\(Z_i\)</span> (which we observe) is random, but that <span class="math notranslate nohighlight">\(Y_i(0)\)</span> and <span class="math notranslate nohighlight">\(Y_i(1)\)</span> (which are unknown) are fixed. In this case, the statement of independence above doesn’t really make sense, since <span class="math notranslate nohighlight">\(Y_i(0)\)</span> and <span class="math notranslate nohighlight">\(Y_i(1)\)</span> are not random. However, we can still compute the Neyman estimator. We’ll develop some properties of the estimator, then use those to construct a confidence interval for the estimated ATE. Finally, we’ll look at two different hypothesis tests used in randomized experiments.</p>
<section id="properties-of-the-neyman-estimator">
<h3>Properties of the Neyman estimator<a class="headerlink" href="#properties-of-the-neyman-estimator" title="Link to this heading">#</a></h3>
<p>The Neyman estimator has two useful properties: the first is that it’s unbiased, and the second is that its variance depends on the estimated variances within the two groups:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
E[\hat{\tau}] &amp;= \tau \\
\text{var}(\hat{\tau}) &amp;\leq \frac{\hat{\sigma}_1^2}{n_1} + \frac{\hat{\sigma}_0^2}{n_0},
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\sigma}_k\)</span> is the sample standard deviation of the potential treatment outcomes <span class="math notranslate nohighlight">\(Y_1(k), \ldots, Y_n(k)\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
    \hat{\sigma}_k &amp;= 
            \frac{1}{n - 1} \sum_{i} \big(Y_i(k) - \bar{Y}(k)\big)
\end{align*}
\]</div>
<p>Since this depends on the counterfactual outcomes that we don’t get to observe, we’ll typically approximate it by replacing the true sample variances with the sample variances within each observed group in our data, and call this <span class="math notranslate nohighlight">\(\hat{V}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
    \hat{V} &amp;= 
    \Bigg[\frac{1}{n_1}
        \underbrace{%
            \frac{1}{n_1 - 1} \sum_{i: Z_i = 1} \big(Y_i - \bar{Y}_{obs,1}\big)^2}_{%
            \text{sample std. dev. of treatment group}}\Bigg] +
    \Bigg[\frac{1}{n_0}
        \underbrace{%
            \frac{1}{n_0 - 1} \sum_{i: Z_i = 0} \big(Y_i - \bar{Y}_{obs,0}\big)^2}_{%
            \text{sample std. dev. of control group}}\Bigg]
\end{align*}
\]</div>
<p>It can be shown that under certain regularity conditions, as the number of samples grows larger, the distribution of the quantity <span class="math notranslate nohighlight">\(\frac{\hat{\tau} - \tau}{\sqrt{\hat{V}}}\)</span> converges to a normal distribution <span class="math notranslate nohighlight">\(N(0, \sigma^2)\)</span>, where <span class="math notranslate nohighlight">\(\sigma^2 &lt; 1\)</span>.</p>
</section>
<section id="confidence-intervals-for-the-ate">
<h3>Confidence intervals for the ATE<a class="headerlink" href="#confidence-intervals-for-the-ate" title="Link to this heading">#</a></h3>
<p>Given the fact above, we can construct an asymptotically valid <span class="math notranslate nohighlight">\(95\%\)</span> confidence interval for <span class="math notranslate nohighlight">\(\tau\)</span> as follows:
$<span class="math notranslate nohighlight">\(
\begin{align*}
    \left(\hat{\tau} - 1.96\sqrt{\hat{V}}, \hat{\tau} + 1.96\sqrt{\hat{V}}\right)
\end{align*}
\)</span>$</p>
</section>
<section id="hypothesis-testing-for-causal-effects">
<h3>Hypothesis testing for causal effects<a class="headerlink" href="#hypothesis-testing-for-causal-effects" title="Link to this heading">#</a></h3>
<p>In the classic null hypothesis significance testing framework, there are two different null hypotheses commonly used when measuring causal effects in randomized trials:</p>
<ol class="arabic simple">
<li><p><strong>Fisher’s strong null</strong> (also known as Fisher’s sharp null) states that for every unit, the treatment effect <span class="math notranslate nohighlight">\(Y_i(1) - Y_i(0) = 0\)</span>.</p></li>
<li><p><strong>Neyman’s weak null</strong> states that the average treatment effect is 0. In other words, even if some individual treatment effects are positive and some are negative, they average out to 0.</p></li>
</ol>
<p>The first is a much stricter null hypothesis (hence the name “strong null”), since it states that all the treatment effects are 0. The second is looser, requiring only that the treatment effects average out to 0. Because of this, the strong null is often easier to reject.</p>
<p>To test a hypothesis against Neyman’s weak null, we construct the test statistic <span class="math notranslate nohighlight">\(\frac{\hat{\tau}}{\sqrt{\hat{V}}}\)</span>. Under the Neyman weak null hypothesis, this should follow a standard normal distribution.</p>
<p>To test a hypothessis against Fisher’s strong null, we need some stronger mathematical machinery. We’ll limit ourself to cases where the treatment and outcome are both binary, and use a technique called <strong>permutation testing</strong>. In this technique, we randomly shuffle the treatment/control labels, and use that to build a null distribution for the difference in outcomes (for a refresher on this technique, see the <a class="reference external" href="https://www.inferentialthinking.com/chapters/12/1/AB_Testing.html">Data 8 textbook</a>). Instead of randomly shuffling, however, Fisher’s exact test instead looks at every single possible permutation, and computes a <span class="math notranslate nohighlight">\(p\)</span>-value in closed form.</p>
</section>
</section>
<section id="optional-complications-with-randomized-experiments">
<h2>(Optional) Complications with randomized experiments<a class="headerlink" href="#optional-complications-with-randomized-experiments" title="Link to this heading">#</a></h2>
<p>Randomized experiments present several challenges that make them infeasible in some circumstances. Here are some of the issues that come up with them. Note that this list is far from exhaustive!</p>
<section id="compliance">
<h3>Compliance<a class="headerlink" href="#compliance" title="Link to this heading">#</a></h3>
<p>Carrying out a randomized experiment requires that the units follow their treatment/no-treatment assignment. This is easier to ensure in some experiments than others. Consider the following examples:</p>
<ol class="arabic simple">
<li><p>An experiment to determine whether a new fertilizer increases crop yield</p></li>
<li><p>A double-blind vaccine trial</p></li>
<li><p>An experiment on whether using a new app for at least 20 minutes a day causes better sleep</p></li>
<li><p>An experiment on whether eating a certain amount of chocolate causes improved heart function</p></li>
</ol>
<p>For the first two, we can guarantee that the treatment will be properly followed. As experimenters, we know that if a certain unit (plant, person, etc.) is assigned to the treatment group, that they will receive the treatment.</p>
<p>For the last two, however, this is more difficult to ensure. While we can ask subjects in a research study to use an app for a certain amount of time per day, we can’t guarantee that every subject will follow the instructions perfectly.</p>
<p>In particular, in some randomized experiments, we can’t guarantee that units will be <strong>compliant</strong> with the treatment assignment. We can’t solve this by simply removing the units that were non-compliant, since this could introduce bias and/or confounding.</p>
</section>
<section id="external-validity">
<h3>External validity<a class="headerlink" href="#external-validity" title="Link to this heading">#</a></h3>
<p><strong>External validity</strong> refers to whether or not a finding from a randomized experiment will apply to a broader population of interest. This often arises due to sampling bias, contrived situations in an experiment that don’t reflect real-world conditions, or other similar effects.</p>
<p>Consider the following example:</p>
<blockquote>
<div><p>Suppose we want to determine whether watching a 15-minute video about common pitfalls and misunderstandings of probability helps people make better decisions about whether news stories they read are valid. We recruit a sample of Data 102 students, randomly assign half to watch the video, and assign the other half not to watch the video. We then evaluate how well they can critically evaluate several news stories. We find that the videos have no effect: everyone in our sample does an excellent job of evaluation, regardless of whether or not they watched the video.</p>
</div></blockquote>
<p>In this case, our randomized experiment shows no causal effect, but our sample is not representative of the population at large: we can expect that most Data 102 students, who are probability experts, already know the common pitfalls in the 15-minute video. Among a larger population, however, the same might not be true!</p>
</section>
<section id="ethical-considerations">
<h3>Ethical considerations<a class="headerlink" href="#ethical-considerations" title="Link to this heading">#</a></h3>
<p>Randomized experiments might not always be ethical. Suppose we want to determine whether or not the death penalty acts as a deterrent: in other words, does instituting the death penalty cause a reduction in crime?</p>
<p>Random assignment of the death penalty is profoundly unethical, and no randomized experiment can determine this.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/chapters/04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03_causality.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Causality</p>
      </div>
    </a>
    <a class="right-next"
       href="05_observational_studies_unconfoundedness.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Causal Inference in Observational Studies: Unconfoundedness</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#randomized-experiments-and-potential-outcomes">Randomized experiments and potential outcomes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-average-treatment-effect">Computing the average treatment effect</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-fixed-sample-assumption-fisher-and-neyman">(Optional) Fixed-sample assumption: Fisher and Neyman</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-neyman-estimator">Properties of the Neyman estimator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-for-the-ate">Confidence intervals for the ATE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hypothesis-testing-for-causal-effects">Hypothesis testing for causal effects</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-complications-with-randomized-experiments">(Optional) Complications with randomized experiments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compliance">Compliance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#external-validity">External validity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ethical-considerations">Ethical considerations</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Data 102 Staff
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>
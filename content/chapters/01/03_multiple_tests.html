

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Multiple Hypothesis Testing &#8212; Data, Inference, and Decisions</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/chapters/01/03_multiple_tests';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Binary Classification" href="04_binary_classification.html" />
    <link rel="prev" title="Hypothesis Testing" href="02_hypothesis_testing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Data, Inference, and Decisions</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data, Inference, and Decisions
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Chapter 1: Binary Decision-Making</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_decisions_and_errors.html">Binary Decision-Making and Error Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_hypothesis_testing.html">Hypothesis Testing and p-Values</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Multiple Hypothesis Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_binary_classification.html">Binary Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_decision_theory.html">Decision Theory</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/intro.html">Chapter 2: Bayesian modeling</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/01_parameter_estimation.html">Parameter Estimation and Bayesian Inference Fundamentals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/02_hierarchical_models.html">Hierarchical Bayesian Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/03_graphical_models.html">Graphical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/04_inference_sampling.html">Bayesian Inference and Sampling</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03/intro.html">Chapter 3: Generalized linear models</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../03/00_regression_review.html">Multiple Linear Regression Review</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ds-102/ds-102-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ds-102/ds-102-book/issues/new?title=Issue%20on%20page%20%2Fcontent/chapters/01/03_multiple_tests.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/content/chapters/01/03_multiple_tests.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multiple Hypothesis Testing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-testing-and-the-replication-crisis">Multiple testing and the replication crisis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#different-approaches-to-multiple-testing">Different approaches to multiple testing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#randomness-fwer-fdr-and-fdp">Randomness, FWER, FDR, and FDP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bonferroni-correction">Bonferroni correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-benjamini-hochberg-procedure">The Benjamini-Hochberg Procedure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-visual-representation-of-naive-thresholding-bonferroni-and-benjamini-hochberg">A Visual Representation of Naive thresholding, Bonferroni, and Benjamini-Hochberg</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-does-benjamini-hochberg-control-fdr">Why does Benjamini-Hochberg Control FDR?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-and-contrasting-fwer-and-fdr">Comparing and Contrasting FWER and FDR</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="multiple-hypothesis-testing">
<h1>Multiple Hypothesis Testing<a class="headerlink" href="#multiple-hypothesis-testing" title="Permalink to this heading">#</a></h1>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>  <span class="c1"># This helps make our plots look nicer</span>

<span class="c1"># These make our figures bigger</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="multiple-testing-and-the-replication-crisis">
<h2>Multiple testing and the replication crisis<a class="headerlink" href="#multiple-testing-and-the-replication-crisis" title="Permalink to this heading">#</a></h2>
<p><em>Coming soon</em></p>
<section id="different-approaches-to-multiple-testing">
<h3>Different approaches to multiple testing<a class="headerlink" href="#different-approaches-to-multiple-testing" title="Permalink to this heading">#</a></h3>
<p>We’ve seen that when we conduct multiple hypothesis tests at a fixed <span class="math notranslate nohighlight">\(p\)</span>-value threshold, we can control the FPR of each test, but we don’t necessarily control the rate of making errors across multiple tests. In order to address this, we’ll define error rates involving all the tests we conduct, and find algorithms that control those error rates. We’ll let <span class="math notranslate nohighlight">\(m\)</span> be the number of hypothesis tests, and define two error rates:</p>
<ul class="simple">
<li><p>The <strong>family-wise error rate (FWER)</strong> is the probability of any one of the <span class="math notranslate nohighlight">\(m\)</span> tests resulting in a false positive.</p></li>
<li><p>The <strong>false discovery rate (FDR)</strong> is the expected value of the false discovery proportion (FDP) for the <span class="math notranslate nohighlight">\(m\)</span> tests.</p></li>
</ul>
<p>We’ll explore two algorithms that we can apply to the <span class="math notranslate nohighlight">\(p\)</span>-values obtained from all <span class="math notranslate nohighlight">\(m\)</span> tests: Bonferroni correction, which controls FWER, and the Benjamini-Hochberg procedure, which controls FDR. Here, “controls” means that we’re guaranteeing that error rate will be below a certain value we choose. Once we describe the algorithms, we’ll discuss the tradeoffs between the two, and how those tradeoffs are related to the inherent properties of the two error rates.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/6BrafO72h_w"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/ILLMDQkQl9A"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
</section>
<section id="randomness-fwer-fdr-and-fdp">
<h2>Randomness, FWER, FDR, and FDP<a class="headerlink" href="#randomness-fwer-fdr-and-fdp" title="Permalink to this heading">#</a></h2>
<p><em>Coming soon</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/G9EYjVfLLBU"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="bonferroni-correction">
<h2>Bonferroni correction<a class="headerlink" href="#bonferroni-correction" title="Permalink to this heading">#</a></h2>
<p>Bonferroni correction is very simple: it says that if we want to guarantee that our FWER for <span class="math notranslate nohighlight">\(m\)</span> tests will be less than or equal to some value we choose (we’ll call it <span class="math notranslate nohighlight">\(\alpha\)</span>), then we just need to use a <span class="math notranslate nohighlight">\(p\)</span>-value threshold of <span class="math notranslate nohighlight">\(\alpha/m\)</span> to make a decision for each test. For example, if we want to guarantee an FWER of <span class="math notranslate nohighlight">\(0.01\)</span> for <span class="math notranslate nohighlight">\(500\)</span> tests, we should use a <span class="math notranslate nohighlight">\(p\)</span>-value threshold for each test of <span class="math notranslate nohighlight">\(0.01 / 5000 = 2 \times 10^{-6}\)</span>.</p>
<p>Let’s show why this formula works. We’ll start by establishing some facts and definitions that we need.</p>
<p>To start, we’ll need to use the <a class="reference external" href="https://en.wikipedia.org/wiki/Boole%27s_inequality">union bound</a>, which states that for events <span class="math notranslate nohighlight">\(A_1, \ldots, A_m\)</span>, that
$<span class="math notranslate nohighlight">\(
P\left(\bigcup_{i=1}^m A_i\right) \leq \sum_{i=1}^m P(A_i).
\)</span>$</p>
<p>Informally, this says that if we add up the independent probabilities of the events occuring, the result will always be greater than or equal to the probability of the union of those events. Intuitively, this is true because when computing the probability of the union, we have to effectively subtract off the overlap between probabilities.</p>
<p>We’ll also define the indicator variables <span class="math notranslate nohighlight">\(T_1, \ldots, T_m\)</span>, where <span class="math notranslate nohighlight">\(T_i\)</span> is the event that test <span class="math notranslate nohighlight">\(i\)</span> results in a false positive. The family-wise error rate is the probability that any one of the tests is a false positive: in other words,  <span class="math notranslate nohighlight">\(FWER = P(T_1 \cup T_2 \cup T_3 \cdots \cup T_m)\)</span>. We know from the previous section that if we use the same <span class="math notranslate nohighlight">\(p\)</span>-value threshold <span class="math notranslate nohighlight">\(\gamma\)</span> for each test, then <span class="math notranslate nohighlight">\(P(T_i) = \gamma\)</span>.</p>
<p>Putting it all together, we have:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
FWER 
    &amp;= P\left(\bigcup_{i=1}^m T_i\right) \\
    &amp;\leq \sum_{i=1}^m P\left(T_i\right) \\
    &amp;= m\gamma
\end{align*}
\end{split}\]</div>
<p>If we choose our <span class="math notranslate nohighlight">\(p\)</span>-value threshold for each test <span class="math notranslate nohighlight">\(\gamma\)</span> to be equal to <span class="math notranslate nohighlight">\(\alpha/m\)</span> (recall that <span class="math notranslate nohighlight">\(\alpha\)</span> is our desired FWER), then the right-hand side becomes <span class="math notranslate nohighlight">\(\alpha\)</span>, and we guarantee that our FWER is less than or equal to <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/zwydh-K6Sc4"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="the-benjamini-hochberg-procedure">
<h2>The Benjamini-Hochberg Procedure<a class="headerlink" href="#the-benjamini-hochberg-procedure" title="Permalink to this heading">#</a></h2>
<p>The Benjamini-Hochberg (often abbreviated to B-H) procedure is slightly more complicated, but it also uses the same <span class="math notranslate nohighlight">\(p\)</span>-value threshold for all tests. The key is that we use the <span class="math notranslate nohighlight">\(p\)</span>-values themselves to determine the threshold. Here’s how it works, for a desired FDR <span class="math notranslate nohighlight">\(\alpha\)</span>:</p>
<ul class="simple">
<li><p>First, sort the <span class="math notranslate nohighlight">\(p\)</span>-values, and index them by <span class="math notranslate nohighlight">\(k\)</span> (i.e., the first one corresponds to <span class="math notranslate nohighlight">\(k=1\)</span>, the second one corresponds to <span class="math notranslate nohighlight">\(k=2\)</span>, and so on, until the last one corresponds to <span class="math notranslate nohighlight">\(k=m\)</span>)</p></li>
<li><p>For each sorted <span class="math notranslate nohighlight">\(p\)</span>-value, compare it to the value <span class="math notranslate nohighlight">\(k\alpha/m\)</span> (i.e., the first one gets compared to <span class="math notranslate nohighlight">\(\alpha/m\)</span>, the second one gets compared to <span class="math notranslate nohighlight">\(2\alpha/m\)</span>, and so on, until the last one gets compared to <span class="math notranslate nohighlight">\(\alpha\)</span>)</p></li>
<li><p>Find the largest sorted <span class="math notranslate nohighlight">\(p\)</span>-value that’s still below the comparison value</p></li>
<li><p>Use that <span class="math notranslate nohighlight">\(p\)</span>-value as the threshold</p></li>
</ul>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/w1yZTe7X1JM"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="a-visual-representation-of-naive-thresholding-bonferroni-and-benjamini-hochberg">
<h2>A Visual Representation of Naive thresholding, Bonferroni, and Benjamini-Hochberg<a class="headerlink" href="#a-visual-representation-of-naive-thresholding-bonferroni-and-benjamini-hochberg" title="Permalink to this heading">#</a></h2>
<p>Consider the <span class="math notranslate nohighlight">\(p\)</span>-values we looked at in the last section. We’ll add a column <code class="docutils literal notranslate"><span class="pre">k</span></code> that provides the index after being sorted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_sorted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;p_values.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pvalue&#39;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_sorted</span><span class="p">)</span>  <span class="c1"># number of tests</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># index of each test in sorted order</span>

<span class="n">p_sorted</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> 
<span class="n">p_sorted</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pvalue</th>
      <th>is_alternative</th>
      <th>k</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20</th>
      <td>0.000008</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>43</th>
      <td>0.000109</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>56</th>
      <td>0.000162</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>82</th>
      <td>0.000219</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000436</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.952674</td>
      <td>0</td>
      <td>96</td>
    </tr>
    <tr>
      <th>49</th>
      <td>0.978843</td>
      <td>0</td>
      <td>97</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.980498</td>
      <td>0</td>
      <td>98</td>
    </tr>
    <tr>
      <th>42</th>
      <td>0.982076</td>
      <td>0</td>
      <td>99</td>
    </tr>
    <tr>
      <th>31</th>
      <td>0.986542</td>
      <td>0</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 3 columns</p>
</div></div></div>
</div>
<p>We can visualize the <span class="math notranslate nohighlight">\(p\)</span>-values in sorted order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p_sorted</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">p_sorted</span><span class="p">[</span><span class="s1">&#39;is_alternative&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5c0ea4cc8300689f4135cce300cf1dedd10ad76fcb046b70907b90955c091071.png" src="../../../_images/5c0ea4cc8300689f4135cce300cf1dedd10ad76fcb046b70907b90955c091071.png" />
</div>
</div>
<p>Here, the <span class="math notranslate nohighlight">\(x\)</span>-axis is <span class="math notranslate nohighlight">\(k\)</span>, the index, and the <span class="math notranslate nohighlight">\(y\)</span>-axis represents the <span class="math notranslate nohighlight">\(p\)</span>-value. We can visualize the results of two techniques:</p>
<ul class="simple">
<li><p>If we use a naive <span class="math notranslate nohighlight">\(p\)</span>-value threshold of 0.05 for all tests, we will obtain an FPR of 0.05. This threshold is the black line below.</p></li>
<li><p>If we use Bonferroni correction and want a FWER of 0.05 (i.e., the probability of making any false positives at all is 0.05), then we should use a <span class="math notranslate nohighlight">\(p\)</span>-value threshold of <span class="math notranslate nohighlight">\(\frac{0.05}{100} = 0.0005\)</span>. This threshold is the red line below:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">desired_fwer</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p_sorted</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">p_sorted</span><span class="p">[</span><span class="s1">&#39;is_alternative&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;No correction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">desired_fwer</span> <span class="o">/</span> <span class="n">m</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bonferroni&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7c4446dc4b8470d9ad9b84966fcfe38d24835aff11b9207a2d2496060d4d48af.png" src="../../../_images/7c4446dc4b8470d9ad9b84966fcfe38d24835aff11b9207a2d2496060d4d48af.png" />
</div>
</div>
<p>In this visualization, how does the Benjamini-Hochberg procedure work? We compare each <span class="math notranslate nohighlight">\(p\)</span>-value to the comparison value <span class="math notranslate nohighlight">\(k\alpha/m\)</span>, which in this visualization is a line. In order to better see what’s going on, we’ll also zoom in on a narrower range of <span class="math notranslate nohighlight">\(p\)</span>-values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">desired_fdr</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p_sorted</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">p_sorted</span><span class="p">[</span><span class="s1">&#39;is_alternative&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">/</span><span class="n">m</span> <span class="o">*</span> <span class="n">desired_fdr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;B-H guide&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.0405</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5b12182310c5fca932f3fa3dc661a8935a0905a755bc757a112f021c65990539.png" src="../../../_images/5b12182310c5fca932f3fa3dc661a8935a0905a755bc757a112f021c65990539.png" />
</div>
</div>
<p>The Bonferroni procedure says to take the largest <span class="math notranslate nohighlight">\(p\)</span>-value that’s below the comparison value: in this case, that’s the point at index 16. This becomes our <span class="math notranslate nohighlight">\(p\)</span>-value threshold, so we choose to reject the null hypothesis for the first 16 <span class="math notranslate nohighlight">\(p\)</span>-values (after being sorted).</p>
<section id="why-does-benjamini-hochberg-control-fdr">
<h3>Why does Benjamini-Hochberg Control FDR?<a class="headerlink" href="#why-does-benjamini-hochberg-control-fdr" title="Permalink to this heading">#</a></h3>
<p><em>Coming soon</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/e10W3lJsBhc"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
</section>
<section id="comparing-and-contrasting-fwer-and-fdr">
<h2>Comparing and Contrasting FWER and FDR<a class="headerlink" href="#comparing-and-contrasting-fwer-and-fdr" title="Permalink to this heading">#</a></h2>
<p><em>Coming soon</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/hD6zX8zZU_A"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/chapters/01"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="02_hypothesis_testing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Hypothesis Testing</p>
      </div>
    </a>
    <a class="right-next"
       href="04_binary_classification.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Binary Classification</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-testing-and-the-replication-crisis">Multiple testing and the replication crisis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#different-approaches-to-multiple-testing">Different approaches to multiple testing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#randomness-fwer-fdr-and-fdp">Randomness, FWER, FDR, and FDP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bonferroni-correction">Bonferroni correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-benjamini-hochberg-procedure">The Benjamini-Hochberg Procedure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-visual-representation-of-naive-thresholding-bonferroni-and-benjamini-hochberg">A Visual Representation of Naive thresholding, Bonferroni, and Benjamini-Hochberg</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-does-benjamini-hochberg-control-fdr">Why does Benjamini-Hochberg Control FDR?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-and-contrasting-fwer-and-fdr">Comparing and Contrasting FWER and FDR</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Data 102 Staff
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>